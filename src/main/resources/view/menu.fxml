<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.collections.FXCollections?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import java.lang.String?>

<AnchorPane maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" prefHeight="630.0" prefWidth="800.0" stylesheets="/stylesheet/menu.css" xmlns="http://javafx.com/javafx/23" xmlns:fx="http://javafx.com/fxml/1" fx:controller="Controller.menuController">
  <children>
     <HBox spacing="10" AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0" AnchorPane.topAnchor="0">
      <VBox alignment="CENTER" prefHeight="600.0" prefWidth="600.0" spacing="10" styleClass="sidebar" AnchorPane.leftAnchor="10" AnchorPane.topAnchor="10">
        <Button alignment="CENTER_LEFT" onAction="#showDocumentListTab" prefHeight="100" styleClass="sidebar-button">
          <graphic>
        <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
          <Image url="@/icons/document_list.png" />
        </ImageView>
          </graphic>
          <text>Danh sách tài liệu</text>
        </Button>
        <Button alignment="CENTER_LEFT" onAction="#showManagementTab" prefHeight="100" styleClass="sidebar-button">
          <graphic>
        <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
          <Image url="@/icons/management.png" />
        </ImageView>
          </graphic>
          <text>Quản lý</text>
        </Button>
        <Button alignment="CENTER_LEFT" onAction="#showBorrowReturnTab" prefHeight="100" styleClass="sidebar-button">
          <graphic>
        <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
          <Image url="@/icons/borrow_return.png" />
        </ImageView>
          </graphic>
          <text>Mượn/Trả tài liệu</text>
        </Button>
      </VBox>
      <StackPane fx:id="stackPane" prefHeight="630.0" prefWidth="1119.0" HBox.hgrow="ALWAYS">
    <BorderPane fx:id="documentTab" styleClass="bg-white" visible="true">
  <top>
    <HBox alignment="CENTER" spacing="10">
      <padding>
        <Insets bottom="10" left="10" right="10" top="10" />
      </padding>
      <Button onAction="#handleFilterAction" styleClass="btn-icon">
        <graphic>
          <ImageView fitHeight="25" fitWidth="25" preserveRatio="true" smooth="true">
            <Image url="@/icons/search.png" />
          </ImageView>
        </graphic>
      </Button>
      <TextField fx:id="tfFilter" onAction="#handleFilterAction" promptText="Lọc theo tên" styleClass="form-control search-field" HBox.hgrow="ALWAYS" />
    </HBox>
  </top>
  <center>
    <VBox spacing="10">
      <TableView fx:id="tvDocuments" styleClass="table, table-hover" prefHeight="360.0" prefWidth="1200.0">
        <columns>
          <TableColumn fx:id="colId" prefWidth="100.0" text="ID" />
          <TableColumn fx:id="colName" prefWidth="150.0" text="Tên" />
          <TableColumn fx:id="colAuthor" prefWidth="150.0" text="Tác giả" />
          <TableColumn fx:id="colCategory" prefWidth="150.0" text="Thể loại" />
          <TableColumn fx:id="colPublisher" prefWidth="150.0" text="Nhà xuất bản" />
          <TableColumn fx:id="colYear" prefWidth="100.0" text="Năm xuất bản" />
          <TableColumn fx:id="colQuantity" prefWidth="100.0" text="Số lượng" />
        </columns>
        <columnResizePolicy>
          <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
        </columnResizePolicy>
      </TableView>
      <VBox spacing="20" styleClass="rating-box" prefHeight="360.0" prefWidth="1200.0" VBox.vgrow="ALWAYS">
        <padding>
          <Insets bottom="10" left="10" right="10" top="10" />
        </padding>
        <Label text="Đánh giá và Điểm số" styleClass="h4" style="-fx-font-size: 24px; -fx-font-weight: bold;" />
        <HBox spacing="10" alignment="CENTER_LEFT">
        <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-border-color: #ccc; -fx-border-width: 1; -fx-padding: 10; -fx-background-color: #f9f9f9; -fx-border-radius: 5; -fx-background-radius: 5;">
          <Label text="Điểm số:" style="-fx-font-size: 16px;" />
          <Label fx:id="scoreLabel" text="N/A" style="-fx-font-size: 16px; -fx-font-weight: bold;" />
        </HBox>
        <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-border-color: #ccc; -fx-border-width: 1; -fx-padding: 10; -fx-background-color: #f9f9f9; -fx-border-radius: 5; -fx-background-radius: 5;">
            <Label text="Độ chính xác:" style="-fx-font-size: 16px;" />
            <Label fx:id="accuracyLabel" text="N/A" style="-fx-font-size: 16px; -fx-font-weight: bold;" />
        </HBox>
        </HBox>
        <HBox spacing="10" alignment="CENTER_LEFT">
          
          <TextArea fx:id="reviewTextArea" editable="false" prefHeight="300.0" prefWidth="1100.0" wrapText="true" style="-fx-font-size: 16px;" />
        </HBox>
      </VBox>
    </VBox>
  </center>
  <right>
    <VBox prefHeight="572.0" prefWidth="359.0" spacing="10" styleClass="detail-box">
      <HBox alignment="CENTER" styleClass="title-box">
        <Label style="-fx-font-size: 20px; -fx-font-weight: bold;" styleClass="h4 title-text" text="Chi tiết tài liệu" />
      </HBox>
      <TextArea fx:id="taDocumentDetails" editable="false" prefHeight="200.0" prefWidth="350.0" style="-fx-font-size: 14px;" styleClass="form-control large-text" wrapText="true" />
      <Button alignment="CENTER" onAction="#handleReload" prefHeight="50" prefWidth="50">
        <graphic>
          <ImageView fitHeight="50" fitWidth="50" preserveRatio="true" smooth="true">
            <Image url="@/icons/update.png" />
          </ImageView>
        </graphic>
      </Button>
      <HBox alignment="CENTER">
        <ImageView fx:id="bookCoverImageView" fitHeight="300.0" fitWidth="200.0" preserveRatio="false" smooth="true" />
      </HBox>
      <Button onAction="#handleChangeCover" text="Thay bìa sách" styleClass="btn, btn-secondary" alignment="CENTER">
        <graphic>
          <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
            <Image url="@/icons/edit.png" />
          </ImageView>
        </graphic>
      </Button>
      <Button onAction="#handleFetchIncorrectInfo" text="Lấy thông tin không chính xác từ Google" styleClass="btn, btn-warning" alignment="CENTER">
        <graphic>
          <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
            <Image url="@/icons/google.png" />
          </ImageView>
        </graphic>
      </Button>
    </VBox>
  </right>
</BorderPane>
        <BorderPane fx:id="managementTab" styleClass="bg-white" visible="false">
          <top>
            <HBox alignment="CENTER_LEFT" spacing="10" styleClass="toolbar">
              <Button onAction="#onAddDocument" text="Thêm tài liệu" styleClass="btn, btn-primary">
                <graphic>
                  <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
                    <Image url="@/icons/add.png" />
                  </ImageView>
                </graphic>
              </Button>
              <Button onAction="#onDeleteDocument" text="Xóa tài liệu" styleClass="btn, btn-danger">
                <graphic>
                  <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
                    <Image url="@/icons/delete.png" />
                  </ImageView>
                </graphic>
              </Button>
              <Button onAction="#onEditDocument" text="Sửa tài liệu" styleClass="btn, btn-info">
                <graphic>
                  <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
                    <Image url="@/icons/edit.png" />
                  </ImageView>
                </graphic>
              </Button>
              <Button onAction="#onManageMembers" text="Quản lý thành viên" styleClass="btn, btn-success">
                <graphic>
                  <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
                    <Image url="@/icons/manage.png" />
                  </ImageView>
                </graphic>
              </Button>
            </HBox>
          </top>
          <center>
            <StackPane fx:id="managementStackPane">
                <VBox alignment="CENTER" spacing="20">
      <padding>
        <Insets bottom="20" left="20" right="20" top="20" />
      </padding>
      <ImageView fitHeight="50" fitWidth="50" preserveRatio="true" smooth="true">
        <Image url="@/images/register/warning.png" />
      </ImageView>
      <Label text="Quản lý tài liệu và thành viên" style="-fx-font-size: 24px; -fx-font-weight: bold;" styleClass="h4 center-text" />
      <VBox spacing="10" styleClass="warning-box" prefWidth="600.0">
        <Label text="Cảnh báo nguy hiểm và rủi ro" styleClass="warning-title" wrapText="true" />
        <Label text="Việc thêm, xóa hoặc chỉnh sửa dữ liệu liên quan đến sách và nhân viên trong hệ thống có thể gây ra những hậu quả nghiêm trọng, bao gồm mất mát dữ liệu, làm sai lệch thông tin và ảnh hưởng đến tính toàn vẹn của hệ thống quản lý." styleClass="warning-text" wrapText="true" />
        <Label text="Chỉ những người có quyền quản trị được phép thực hiện các thao tác này. Việc truy cập hoặc thao tác trái phép sẽ bị ghi nhận và có thể dẫn đến các hình thức xử lý kỷ luật, bao gồm các trách nhiệm pháp lý theo quy định." styleClass="warning-text" wrapText="true" />
        <Label text="Yêu cầu quyền quản trị riêng: Hãy chắc chắn rằng bạn có quyền hợp lệ trước khi thực hiện các thao tác quản lý dữ liệu. Việc thiếu quyền hạn có thể dẫn đến việc bị từ chối truy cập và các hình phạt pháp lý." styleClass="warning-text" wrapText="true" />
        <Label text="Lưu ý khi chỉnh sửa: Mọi thay đổi nên được kiểm tra kỹ lưỡng và xác nhận với người chịu trách nhiệm trước khi áp dụng. Đảm bảo thông tin nhập vào chính xác để tránh gây ra sai sót không mong muốn hoặc làm gián đoạn quy trình làm việc." styleClass="warning-text" wrapText="true" />
        <Label text="Việc chỉnh sửa cần có sự kiểm soát cẩn thận và các biện pháp bảo vệ dữ liệu phù hợp để đảm bảo tính an toàn và tránh mất mát thông tin không thể phục hồi." styleClass="warning-text" wrapText="true" />
      </VBox>
    </VBox>
            </StackPane>
          </center>
        </BorderPane>
<BorderPane fx:id="borrowAndReturnTab" styleClass="bg-white" visible="false">
  <top>
    <VBox alignment="CENTER">
      <padding>
        <Insets top="20" />
      </padding>
      <Label text="Quản lý Mượn/Trả Tài Liệu" style="-fx-font-size: 24px; -fx-font-weight: bold;" styleClass="h1 center-text" />
    </VBox>
  </top>
  <center>
    <VBox spacing="20" styleClass="pane-background">
      <padding>
        <Insets bottom="20" left="20" right="20" top="20" />
      </padding>
      <HBox spacing="200" alignment="CENTER">
        <VBox spacing="15" styleClass="form-box" prefWidth="400">
          <ComboBox fx:id="cbMembers" editable="true" prefWidth="250.0" promptText="Chọn thành viên" styleClass="form-control" />
          <ComboBox fx:id="cbDocuments" editable="true" prefWidth="250.0" promptText="Chọn tài liệu" styleClass="form-control" />
          <DatePicker fx:id="dpBorrowDate" promptText="Ngày mượn" styleClass="form-control" />
          <DatePicker fx:id="dpReturnDate" promptText="Ngày trả" styleClass="form-control" />
          <HBox spacing="10">
            <Button onAction="#handleBorrowDocument" text="Mượn tài liệu" styleClass="btn, btn-primary">
              <graphic>
                <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
                  <Image url="@/icons/borrow.png" />
                </ImageView>
              </graphic>
            </Button>
            
          </HBox>
        </VBox>
        <VBox spacing="15" styleClass="warning-box" prefWidth="400">
          <Label text="Lưu ý khi mượn và trả sách" styleClass="warning-title" wrapText="true" />
          <Label text="Hãy kiểm tra kỹ thông tin sách và thành viên trước khi mượn hoặc trả sách để đảm bảo tính chính xác." styleClass="warning-text" wrapText="true" />
          <Label text="Việc mượn và trả sách cần được ghi nhận đầy đủ và chính xác để tránh mất mát hoặc sai lệch thông tin." styleClass="warning-text" wrapText="true" />
          <Label text="Chỉ những người có quyền hạn mới được phép thực hiện các thao tác này. Việc truy cập hoặc thao tác trái phép sẽ bị ghi nhận và có thể dẫn đến các hình thức xử lý kỷ luật." styleClass="warning-text" wrapText="true" />
        </VBox>
      </HBox>
      <VBox spacing="20" styleClass="table-box">
        <TableView fx:id="tvBorrowedDocuments" prefHeight="500.0" styleClass="table, table-hover" VBox.vgrow="ALWAYS">
          <columns>
            <TableColumn fx:id="colMember" prefWidth="200.0" text="Thành viên" />
            <TableColumn fx:id="colDocument" prefWidth="200.0" text="Tài liệu" />
            <TableColumn fx:id="colBorrowDate" prefWidth="200.0" text="Ngày mượn" />
            <TableColumn fx:id="colReturnDate" prefWidth="200.0" text="Ngày trả" />
            <TableColumn fx:id="colStatus" prefWidth="200.0" text="Trạng thái" />
            <TableColumn fx:id="colActualReturnDate" prefWidth="200.0" text="Ngày trả thực tế" />
            <TableColumn fx:id="colDamagePercentage" prefWidth="200.0" text="Phần trăm thiệt hại" />
            <TableColumn fx:id="colPenaltyFee" prefWidth="200.0" text="Phí phạt" />
          </columns>
          <columnResizePolicy>
            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
          </columnResizePolicy>
          <style>
            .table-row-cell {
              -fx-font-size: 20px;
              -fx-padding: 40px; <!-- Increased padding for better visibility -->
            }
          </style>
        </TableView>
            <HBox alignment="CENTER" spacing="10" styleClass="search-box">
              <TextField fx:id="tfSearch" onAction="#handleSearchAction" promptText="Nhập nội dung tìm kiếm" styleClass="form-control search-field" />
              <ComboBox fx:id="cbSearchCriteria" promptText="Tìm kiếm theo" styleClass="form-control">
                <items>
                  <FXCollections fx:factory="observableArrayList">
                    <String fx:value="Thành viên" />
                    <String fx:value="Tài liệu" />
                  </FXCollections>
                </items>
              </ComboBox>
              <Button onAction="#handleSearchAction" text="Tìm kiếm" styleClass="btn, btn-primary">
                <graphic>
                  <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
                    <Image url="@/icons/search.png" />
                  </ImageView>
                </graphic>
              </Button>
              
                <Button onAction="#handleRefreshAction" text="Làm mới" styleClass="btn, btn-info">
            <graphic>
              <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
              <Image url="@/icons/update.png" />
          </ImageView>
            </graphic>
            </Button>
            <Button onAction="#handleReturnDocument" text="Trả tài liệu" styleClass="btn, btn-success">
              <graphic>
                <ImageView fitHeight="20" fitWidth="20" preserveRatio="true" smooth="true">
                  <Image url="@/icons/return.png" />
                </ImageView>
              </graphic>
            </Button>
  
            </HBox>
            </VBox>
    </VBox>
  
  </center>
</BorderPane>
      </StackPane>
    </HBox>
  </children>
</AnchorPane>
